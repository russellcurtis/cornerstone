<?php

print "<h1>Invoices</h1>";

$sql = "SELECT * FROM intranet_timesheet_invoice, intranet_projects WHERE proj_id = invoice_project AND invoice_paid > 0 order by invoice_due";
$result = mysql_query($sql, $conn) or die(mysql_error());

// Include a bar to navigate through the pages

		print "<p class=\"submenu_bar\">";

		$items_to_view = 5;

		if ($_GET[limit] == NULL) {$limit = 0; } else { $limit = $_GET[limit]; }
		$total_items = mysql_num_rows($result);
		$page_prev = $limit - $items_to_view;
		$page_next = $limit + $items_to_view;
		
		if ($limit > 0) { print "<a href=\"index2.php?page=timesheet_invoice_view_paid&amp;limit=$page_prev\" class=\"submenu_bar\">Previous Page</a>"; }
		if ($page_next < $total_items) { print "<a href=\"index2.php?page=timesheet_invoice_view_paid&amp;limit=$page_next\" class=\"submenu_bar\">Next Page</a>"; }
		print "</p>";
		
		
		print "<h2>Complete Invoices on ".TimeFormat(time()).",&nbsp;".($limit + 1)." to ";
		if ($page_next > $total_items) { print $total_items; } else { print $page_next; }
		print " of ".$total_items."</h2>";

print $print_limit;

$nowtime = time();

if (mysql_num_rows($result) > 0) {

print "<table summary=\"List of Completed Invoices\">";

print "<tr><td width=\"15%\"><strong>Invoice Number</strong></td><td><strong>Project Number</strong></td><td><strong>Description</strong></td><td><strong>Issued</strong></td><td><strong>Due</strong></td><td><strong>Value</strong><br /><span class=\"minitext\">(inc. VAT &amp; Expenses)</span></tr>";

$invoice_total_paid = 0;
$invoice_total_thispage = 0;
$counter = 0;

while ($array = mysql_fetch_array($result)) {

  
		$invoice_id = $array['invoice_id'];
		$invoice_date = $array['invoice_date'];
		$invoice_due = $array['invoice_due'];
		$invoice_value_vat = $array['invoice_value_vat'] + $array['invoice_expenses'];
		$invoice_project = $array['invoice_project'];
		$invoice_ref = $array['invoice_ref'];
		$invoice_text = $array['invoice_text'];
		$invoice_expenses = $array['invoice_expenses'];
		$invoice_description = $array['invoice_description'];
		$invoice_paid = $array['invoice_paid'];
		$proj_id = $array['proj_id'];
		$proj_num = $array['proj_num'];
		
		$invoice_total_paid = $invoice_total_paid + $invoice_value_vat;

if ($counter >= $limit AND $counter < $page_next) {
		print "<tr>";	
		print "<td $highlight><a href=\"index2.php?page=timesheet_invoice_view&amp;invoice_id=$invoice_id\">".$invoice_ref."</a>";
		if ($user_usertype_current > 3) {print "<br /><a href=\"index2.php?page=timesheet_invoice_edit&amp;status=edit&amp;invoice_id=$invoice_id\"><img src=\"images/button_edit.png\" alt=\"Edit Invoice\" /></a>"; }
		print "</td>";
		print "<td><a href=\"index2.php?page=project_view&amp;proj_id=$proj_id\">$proj_num</a></td>";
		print "<td>$invoice_text</td>";
		print "<td>".TimeFormat($invoice_date)."</td>";
		print "<td>".TimeFormat($invoice_due)."</td>";
		print "<td>".MoneyFormat($invoice_value_vat)."</td></tr>";
		$invoice_total_thispage = $invoice_total_thispage + $invoice_value_vat;
		}
$counter++;
}

print "<tr><td colspan=\"5\"><strong>Total This Page</strong><td style=\"text-align: right\"><strong>".MoneyFormat($invoice_total_thispage)."</strong></td></tr>";

print "<tr><td colspan=\"5\"><strong>Total Issued</strong><td style=\"text-align: right\"><strong>".MoneyFormat($invoice_total_paid)."</strong></td></tr>";

print "</table>";

} else {

print "<p>There are no paid invoices on the system.</p>";

}

?>